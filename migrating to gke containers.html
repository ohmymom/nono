

<!DOCTYPE html>
<html lang='en'>
<head>
<title>Migrating to GKE Containers | Qwiklabs</title>
<script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"bill","lastname":"kwek","fullname":"bill kwek","company":"Login with Google","email":"scalperta@gmail.com","origin":"google-run, direct","subscriptions":1,"id":"e6fef0d0d46369e817c26e1b532ac353","qlCreatedAt":"2021-03-14 04:41:58 UTC","optIn":false};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="run";
//]]>
</script>
<script>
  dataLayer = [
    {user: gon.current_user},
  ];
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-TQR88QK");
</script>
<script>
  EVENT_SOURCE_BASE_URL = "https://run.qwiklabs.com/nchan-sub?id=";
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-408088dc333247a761de5f2b2a4ba1cabd2bc36579f83ba92a559eb3682a9b77.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-45d462772c30000424907184f70c7157e95fb6227698d1671c5051818a6f60d8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-4920eac3ac3dd22ea1f733628486b64b565cc473b8615f62078c268a7076bc1f.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-8800beeb4f5ed26307f7ea0bbc1b23c870ccd0f31deab4b2451eeb8f68d6a400.js"></script>
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script type='application/ld+json'>
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="+GK4L86WtVVa5R1TBH+ip4a61scHMbPIUfO6NFS9csS3s5oIZno2omos+Vpchfp2FjKE0876tj72j3h4g1K2rA==" />
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[]' name='active-experiments'>
<meta content='{&quot;userId&quot;:4453388}' name='help-api-product-data'>
<meta content='This lab teaches you how to migrate a stateless application from running on a VM to running on Kubernetes Engine (GKE). You will learn about the lifecycle of an application transitioning from a typical VM/OS-based deployment to three different containerized cloud infrastructure platforms.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='Migrating to GKE Containers | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='This lab teaches you how to migrate a stateless application from running on a VM to running on Kubernetes Engine (GKE). You will learn about the lifecycle of an application transitioning from a typical VM/OS-based deployment to three different containerized cloud infrastructure platforms.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<link href='/favicon-32.png' rel='shortcut icon'>
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>



<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons" />


<link rel="stylesheet" media="all" href="https://cdn.qwiklabs.com/assets/application-894f885f2fcdc8fa1947e904fa62671683664f504b653e12c8c2c204996a9e91.css" />



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-TQR88QK' style='display:none;visibility:hidden;' width='0'></iframe>
</noscript>
<span class='hidden' id='flash-sibling-before'></span>

<div class='header-container light-theme'>
<div class='header'>
<ql-icon-button class='js-nav-toggle header__nav-panel-button l-mrm'>menu</ql-icon-button>
<div class='header__title'>
<a class="icon-button" href="https://accounts.google.com/"><ql-icon>arrow_back</ql-icon></a>

<h1 class='headline-5'>
Migrating to GKE Containers
</h1>
</div>
<div class='header__actions'>
<ql-icon-button class='header__button--search js-header-search-bar-button'>search</ql-icon-button>
<ql-icon-button id='share_2762'>share</ql-icon-button>
<ql-menu for='share_2762'>
<ql-menu-item>
<a data-analytics-action="Shared to LinkedIn." data-analytics-category="Lab" data-analytics-label="Migrating to GKE Containers" target="_blank" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frun.qwiklabs.com%2Fcatalog_lab%2F2762%3Futm_medium%3Dsocial%26utm_source%3Dlinkedin%26utm_campaign%3Dql-social-share"><ql-icon class='l-mrs'>post_linkedin</ql-icon>
LinkedIn
</a>
</ql-menu-item>
<ql-menu-item>
<a data-analytics-action="Shared to Twitter." data-analytics-category="Lab" data-analytics-label="Migrating to GKE Containers" target="_blank" href="https://twitter.com/intent/tweet?text=Learn%20cloud%20tech%20through%20hands-on%20training%20on%20%23Qwiklabs%21&amp;url=https%3A%2F%2Frun.qwiklabs.com%2Fcatalog_lab%2F2762%3Futm_medium%3Dsocial%26utm_source%3Dtwitter%26utm_campaign%3Dql-social-share&amp;hashtags="><ql-icon class='l-mrs'>post_twitter</ql-icon>
Twitter
</a>
</ql-menu-item>
<ql-menu-item>
<a data-analytics-action="Shared to Facebook." data-analytics-category="Lab" data-analytics-label="Migrating to GKE Containers" target="_blank" href="https://facebook.com/sharer.php?display=popup&amp;u=https%3A%2F%2Frun.qwiklabs.com%2Fcatalog_lab%2F2762%3Futm_medium%3Dsocial%26utm_source%3Dfacebook%26utm_campaign%3Dql-social-share"><ql-icon class='l-mrs'>post_facebook</ql-icon>
Facebook
</a>
</ql-menu-item>
</ql-menu>

<a class="icon-button js-favorite-button favorite-button" id="CatalogItem-12768-favorite-button" data-type="CatalogItem" data-id="12768" data-name="Migrating to GKE Containers" href="/favorite.json?item_id=12768&amp;item_type=CatalogItem"><ql-icon>favorite_border</ql-icon>
</a><div class='mdl-tooltip js-tooltip' for='CatalogItem-12768-favorite-button'>
Add to favorites
</div>


<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>

<ql-icon-button id='help-menu-button'>help</ql-icon-button>
<div class='mdl-tooltip js-tooltip' data-mdl-for='help-menu-button'>
Help
</div>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item>
<ql-help context='lab' data-analytics-action='opened_help' data-analytics-label='lab' productdata='{&quot;userId&quot;:4453388}'>
Help Center
</ql-help>
</ql-menu-item>
<ql-menu-item>
<a target="_blank" class="ql-body-1" href="https://support.google.com/qwiklabs/contact/contact_us">Email support</a>
</ql-menu-item>
<ql-menu-item>
<a class='ql-body-1' onClick='ql.chat.open()'>Chat support</a>
</ql-menu-item>
</ql-menu>

<button class='icon-button' id='my_account'>
<ql-avatar src='https://lh6.googleusercontent.com/-Lso7BkxWvtc/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnooO6DbKg6AZsUT4Cz1ETczdqn2g/s320-c/photo.jpg'></ql-avatar>
</button>
<ql-menu for='my_account' open>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120' src='https://lh6.googleusercontent.com/-Lso7BkxWvtc/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnooO6DbKg6AZsUT4Cz1ETczdqn2g/s320-c/photo.jpg'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-subhead-1'>bill kwek</h4>
<p class='ql-body-2 text--light'>scalperta@gmail.com</p>
<p class='ql-body-2 text--light'>
</p>
<a class="text--green ql-subhead-2" href="/my_account/payments"><ql-chip positive>
Monthly Subscription
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a class="ql-caption text--light" href="/privacy_policy">Privacy</a>
<span class='ql-caption text--light l-mls l-mrs'>&middot;</span>
<a class="ql-caption text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</div>
<div class='header__search-bar js-header-search-bar'>
<form class="js-search-form-mobile" onsubmit="ql.searchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="YrekmJfxYn0trF1dwLoosmYbJ4ePqCATEAJ6TRHw8I0tZoa/Px3hih1luVSYQHBj9pN1k0ZjJeW3frgBxh805Q==" />
<input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar" />
</form>

<ql-icon-button class='js-close-search-bar'>close</ql-icon-button>
</div>
</div>

<nav class='nav-bar'>
<a class="nav-bar__item js-navigation-button" href="/"><ql-icon class='nav-bar__item__icon'>
home
</ql-icon>
<span class='nav-bar__item__label'>
Home
</span>
</a>
<a class="nav-bar__item js-navigation-button  active" aria-current="page" href="/catalog"><ql-icon class='nav-bar__item__icon'>
school
</ql-icon>
<span class='nav-bar__item__label'>
Catalog
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="/my_learning"><ql-icon class='nav-bar__item__icon'>
event_note
</ql-icon>
<span class='nav-bar__item__label'>
My Learning
</span>
</a>
</nav>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class='logo logo--blue'></div>
</div>
<a title="Home" tabindex="-1" class="nav-panel__item js-navigation-button" href="/"><ql-icon class='nav-panel__item__icon'>
home
</ql-icon>
<div class='nav-panel__item__label'>
Home
</div>
</a>
<a title="Catalog" tabindex="-1" class="nav-panel__item js-navigation-button active" aria-current="page" href="/catalog"><ql-icon class='nav-panel__item__icon'>
school
</ql-icon>
<div class='nav-panel__item__label'>
Catalog
</div>
</a>
<a title="My Learning" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_learning"><ql-icon class='nav-panel__item__icon'>
event_note
</ql-icon>
<div class='nav-panel__item__label'>
My Learning
</div>
</a>
<div class='nav-panel__spacer'></div>
<a title="Profile" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/profile"><ql-icon class='nav-panel__item__icon'>
account_circle
</ql-icon>
<div class='nav-panel__item__label'>
Profile
</div>
</a>
<a title="Credits &amp; Subscriptions" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/credits"><ql-icon class='nav-panel__item__icon'>
money
</ql-icon>
<div class='nav-panel__item__label'>
Credits &amp; Subscriptions
</div>
</a>
<a title="Security" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/security"><ql-icon class='nav-panel__item__icon'>
security
</ql-icon>
<div class='nav-panel__item__label'>
Security
</div>
</a>
<div class='nav-panel__spacer'></div>
<a class="nav-panel__item" tabindex="-1" href="#"><ql-help>
<div class='nav-panel__help-item'>
<ql-icon class='nav-panel__item__icon'>help</ql-icon>
<div class='nav-panel__item__label'>
Help
</div>
</div>
</ql-help>
</a><div class='nav-panel__small-links'>
<a tabindex="-1" href="/privacy_policy">Privacy</a>
<a tabindex="-1" href="/terms_of_service">Terms</a>
</div>
</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main'>
<div class='l-main-wrapper' id='main-wrapper'>







<div class='lab-assessment__tab js-open-lab-assessment-panel'>
<h6 class='js-lab-assessment-total-score'>
&mdash;/100
</h6>
</div>
<div class='lab-assessment__panel js-lab-assessment-panel'>
<div class='lab-assessment__panel__header'>
<h4>Checkpoints</h4>
<ql-icon-button class='js-close-lab-assessment-panel'>arrow_forward</ql-icon-button>
</div>
<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Create Deployment
</p>
<div class='lab-assessment__step__action'>
<a class='button js-show-run-step-button' step_no='1'>
Check my progress
</a>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-1'>
</span>
/ 50
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Load Testing
</p>
<div class='lab-assessment__step__action'>
<a class='button js-show-run-step-button' step_no='2'>
Check my progress
</a>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-2'>
</span>
/ 30
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Scale prime-server deployment
</p>
<div class='lab-assessment__step__action'>
<a class='button js-show-run-step-button' step_no='3'>
Check my progress
</a>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-3'>
</span>
/ 20
</p>
</div>
</div>

</div>
<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Migrating to GKE Containers&quot;,&quot;lab_name&quot;:&quot;Migrating to GKE Containers&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;run&quot;}' data-focus-id='12768' data-lab-billing-limit='0.0' data-lab-duration='4500' data-parent='catalog' data-payment-required data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer'>
<iframe class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labDetails='[]' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:4500}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
              grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                    var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
            var element = document.getElementById(id);
            element.value = token;
          }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message'></p>
<a class='alert__close js-alert-close'>
<i class='fa fa-times'></i>
</a>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='js-lab-content lab-content__renderable-instructions'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Migrating to GKE Containers
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>1 hour 15 minutes</span>
<span>7 Credits</span>
<div class='lab__rating'>
<a href="/focuses/12768/reviews?parent=catalog"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.2943'></div>

</a></div>
</div>
</div>

<div class='js-markdown-instructions markdown-lab-instructions' id='markdown-lab-instructions'>



<p><img alt="GKE-Engine.png" src="https://cdn.qwiklabs.com/QKV092kALeUu8E6Qu3qVrHWJ%2BjkMkSlR%2BwZpsbfX73w%3D"></p>
<h2 id="step1">GSP475</h2>
<p><img alt="Google Cloud Self-Paced Labs" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>

<p>Containers are quickly becoming an industry standard for deployment of software applications. The business and technological advantages of containerizing workloads are driving many teams towards moving their applications to containers. This lab provides a basic walkthrough of migrating a stateless application from running on a VM to running on <a href="https://cloud.google.com/kubernetes-engine/" target="blank">Kubernetes Engine (GKE)</a>. It demonstrates the lifecycle of an application transitioning from a typical VM/OS-based deployment to a specialized os for containers to a platform for containers better known as <a href="https://cloud.google.com/kubernetes-engine/" target="blank">GKE</a>.</p>
<h2 id="step2">Overview</h2>
<p>There are numerous advantages to using containers to deploy applications. Among these are:</p>
<ol>
<li>
<p><em>Isolated</em> - Applications have their own libraries; no conflicts will arise from different libraries in other applications.</p>
</li>
<li>
<p><em>Limited (limits on CPU/memory)</em> - Applications may not hog resources from other applications.</p>
</li>
<li>
<p><em>Portable</em> - The container contains everything it needs and is not tied to an OS or Cloud provider.</p>
</li>
<li>
<p><em>Lightweight</em> - The kernel is shared, making it much smaller and faster than a full OS image.</p>
</li>
</ol>
<h2 id="step3">What you'll learn</h2>
<p>This project demonstrates migrating a simple Python application named <a href="https://github.com/GoogleCloudPlatform/gke-migration-to-containers/blob/master/container/prime-flask-server.py" target="blank">Prime-flask</a> to:</p>
<ol>
<li>
<p>A <a href="https://cloud.google.com/compute/docs/instances/" target="blank">virtual machine (Debian VM)</a> where <code>Prime-flask</code> is deployed as the only application, much like a traditional application is run in an on-premises datacenter</p>
</li>
<li>
<p>A containerized version of <code>Prime-flask</code> is deployed on <a href="https://cloud.google.com/container-optimized-os/" target="blank">Container-Optimized OS (COS)</a></p>
</li>
<li>
<p>A <a href="https://kubernetes.io/" target="blank">Kubernetes</a> deployment where <code>Prime-flask</code> is exposed via a load balancer and deployed in Kubernetes Engine</p>
</li>
</ol>
<p>After the deployment you'll run a load test against the final deployment and scale it to accommodate the load.</p>
<p>If during the lab you get an error, it probably makes sense to re-execute the failing script. Occasionally there are network connectivity issues, and retrying will likely work the subsequent time.</p>
<p>This lab was created by GKE Helmsman engineers to help you grasp a better understanding of migrating to containers. You can view this demo on on Github <a href="https://github.com/GoogleCloudPlatform/gke-migration-to-containers.git" target="blank">here</a>. We encourage any and all to contribute to our assets!</p>
<h2 id="step4">Architecture</h2>
<p><strong>Configuration 1:</strong> a virtual machine running Debian, app deployed directly to the host OS, no containers</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/aBo1TdWIv1Z6t5%2BIM5T%2B3v5popLO9DB0grD9cPjIjYQ%3D"></p>
<p><strong>Configuration 2:</strong> a virtual machine running Container-Optimized OS, app deployed into a container</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/M8wZrtea2pP8VuBZBFoICAeiuSXkf8PmNaDHMwBNJaA%3D"></p>
<p><strong>Configuration 3:</strong> Kubernetes Engine (GKE) platform, many machines running many containers</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/6JpcPcEzTVArtgUNwQfbkWgrd4zh%2BGiENwIoJQ1h92w%3D"></p>
<p>A simple Python <a href="http://flask.pocoo.org/" target="blank">Flask</a> web application (<code>Prime-flask</code>) was created for this demonstration which contains two endpoints:</p>
<p><code>http://&lt;ip&gt;:8080/factorial/</code> and</p>
<p><code>http://&lt;ip&gt;:8080/prime/</code></p>
<p>Examples of use would look like:</p>
<pre><code class="language-console prettyprint">curl http://35.227.149.80:8080/prime/10&#x000A;The sum of all primes less than 10 is 17&#x000A;&#x000A;curl http://35.227.149.80:8080/factorial/10&#x000A;The factorial of 10 is 3628800&#x000A;</code></pre>
<p>Also included is a utility to validate a successful deployment.</p>
<h2 id="step5">Setup</h2>
<h4>Before you click the Start Lab button</h4>
<p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click <strong>Start Lab</strong>, shows how long Google Cloud resources will be made available to you.</p>
<p>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<h4>What you need</h4>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
<li>Time to complete the lab.</li>
</ul>
<p><strong>Note:</strong> If you already have your own personal Google Cloud account or project, do not use it for this lab.</p>
<p><strong>Note:</strong> If you are using a Pixelbook, open an Incognito window to run this lab.</p>

<h4>How to start your lab and sign in to the Google Cloud Console</h4>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is a panel populated with the temporary credentials that you must use for this lab.</p>
<p><img alt="Open Google Console" src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D"></p>
</li>
<li>
<p>Copy the username, and then click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Sign in</strong> page.</p>
<p><img alt="Sign in" src="https://cdn.qwiklabs.com/VkUIAFY2xX3zoHgmWqYKccRLwFrR4BfARLd5ojmlbhs%3D"></p>
<p><strong><em>Tip:</em></strong> Open the tabs in separate windows, side-by-side.</p>
<aside>
 If you see the <strong>Choose an account</strong> page, click <strong>Use Another Account</strong>.
<img alt="Choose an account" src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D">
</aside>
</li>
<li>
<p>In the <strong>Sign in</strong> page, paste the username that you copied from the Connection Details panel. Then copy and paste the password.</p>
<p><strong><em>Important:</em></strong> You must use the credentials from the Connection Details panel. Do not use your Qwiklabs credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</p>
</li>
<li>
<p>Click through the subsequent pages:</p>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
</li>
</ol>
<p>After a few moments, the Cloud Console opens in this tab.</p>
<aside>
<strong>Note:</strong> You can view the menu with a list of Google Cloud Products and Services by clicking the <strong>Navigation menu</strong> at the top-left.
<img alt="Cloud Console Menu" src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D">
</aside>

<h3>Activate Cloud Shell</h3>
<p>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</p>
<p>In the Cloud Console, in the top right toolbar, click the <strong>Activate Cloud Shell</strong> button.</p>
<p><img alt="Cloud Shell icon" src="https://cdn.qwiklabs.com/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D"></p>
<p>Click <strong>Continue</strong>.</p>
<p><img alt="cloudshell_continue.png" src="https://cdn.qwiklabs.com/lr3PBRjWIrJ%2BMQnE8kCkOnRQQVgJnWSg4UWk16f0s%2FA%3D"></p>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><code>gcloud</code> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<p>You can list the active account name with this command:</p>
<pre><code>gcloud auth list&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-output prettyprint">Credentialed accounts:&#x000A; - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)&#x000A;</code></pre>
<p>(Example output)</p>
<pre><code class="language-Output prettyprint">Credentialed accounts:&#x000A; - google1623327_student@qwiklabs.net&#x000A;</code></pre>
<p>You can list the project ID with this command:</p>
<pre><code>gcloud config list project&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-output prettyprint">[core]&#x000A;project = &lt;project_ID&gt;&#x000A;</code></pre>
<p>(Example output)</p>
<pre><code class="language-Output prettyprint">[core]&#x000A;project = qwiklabs-gcp-44776a13dea667a6&#x000A;</code></pre>
<aside>
  For full documentation of <code>gcloud</code> see the <a href="https://cloud.google.com/sdk/gcloud" target="_blank">gcloud command-line tool overview</a>.

</aside>

<h3>Install ApacheBench</h3>
<p>Install ApacheBench with the following command:</p>
<pre><code>sudo apt-get install apache2-utils&#x000A;</code></pre>
<p>Type "y" when asked to confirm you want to continue.</p>
<p>Verify that the installation was successful:</p>
<pre><code>ab -V&#x000A;</code></pre>
<p>Your output should look like this:</p>
<pre><code>This is ApacheBench, Version 2.3 &lt;$Revision: 1757674 $&gt;&#x000A;Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/&#x000A;Licensed to The Apache Software Foundation,&#x000A;</code></pre>

<h3>Clone the repo</h3>
<p>Open a new session in Cloud Shell and run the following command to clone the sample code repository:</p>
<pre><code>git clone https://github.com/GoogleCloudPlatform/gke-migration-to-containers.git&#x000A;</code></pre>
<p>Go into the directory of the demo:</p>
<pre><code>cd gke-migration-to-containers&#x000A;</code></pre>
<h3>Set your region and zone</h3>
<p>Certain Compute Engine resources live in regions and zones. A region is a specific geographical location where you can run your resources. Each region has one or more zones.</p>
<aside>
Learn more about regions and zones and see a complete list in <a href="https://cloud.google.com/compute/docs/regions-zones/" target="_blank">Regions &amp; Zones documentation</a>.

</aside>
<p>Run the following to set a region and zone for your lab (you can use the region/zone that's best for you):</p>
<pre><code>gcloud config set compute/region us-central1&#x000A;gcloud config set compute/zone us-central1-a&#x000A;</code></pre>

<h3>Change machine Type</h3>
<p>In the top-right corner of your Cloud Shell session, click <strong>Open Editor</strong> and then click <strong>Open in new window</strong>:</p>
<p><img alt="cloudshelleditor" src="https://cdn.qwiklabs.com/hZYBOz6ymTpCcrjxYiyPK2gVdwvdXxHVm77O5rBeFfs%3D"></p>
<p>From the left-hand menu, open the <strong>gke-migration-to-containers</strong> &gt; <strong>terraform</strong> &gt; <strong>variables.tf</strong>.</p>
<p>Then scroll down to the "machine_type" configuration (line 25) and change the machine type from <code>f1-micro</code> to <code>n1-standard-1</code>:</p>
<p><img alt="machine-type" src="https://cdn.qwiklabs.com/viOKnHl8C7GukzbwfVeOd3M9oIwcPboO9fMhZITlH1g%3D"></p>
<h2 id="step6">Deployment</h2>
<p>The infrastructure required by this project can be deployed by executing:</p>
<pre><code class="language-console prettyprint">make create&#x000A;</code></pre>
<p>The setup of this demo can take up to <strong>15 minutes</strong> to provision. If there is no error the best thing to do is keep waiting. The execution of <code>make create</code> should <strong>not</strong> be interrupted. While the resources are building, you can check on the progress in the Console by going to <strong>Compute Engine</strong> &gt; <strong>VM instances</strong>.</p>
<p>While you're waiting, read ahead to learn what the <code>create.sh</code> script does and what is getting created for you.</p>
<p>You can view <code>gke-migration-to-containers/scripts/create.sh</code> in the code editor.</p>
<p>The <code>make create</code> command calls the create.sh script which performs following tasks:</p>
<ol>
<li>Packages the deployable <code>Prime-flask</code> application, making it ready to be copied to <a href="https://cloud.google.com/storage/" target="blank">Google Cloud Storage</a>.</li>
<li>Creates the container image via <a href="https://cloud.google.com/cloud-build/" target="blank">Google Cloud Build</a> and pushes it to the private <a href="https://cloud.google.com/container-registry/" target="blank">Container Registry (GCR)</a> for your project.</li>
<li>Generates an appropriate configuration for <a href="https://www.terraform.io" target="blank">Terraform</a>.</li>
<li>Executes Terraform which creates the scenarios outlined above.</li>
</ol>
<p>The following are examples of:</p>
<p>Terraform creating single VM, COS VM, and GKE cluster:</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/nLTbyOA6DIJNh7Y9CocWWFBqjfJm91kpIj7C9EUkIz0%3D"></p>
<p>Terraform outputs showing prime and factorial endpoints for Debian VM and COS system:</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/piLnE93Lo5OnLcF8g2CSW1YV7sGWtxJF3j5RYPtVSRI%3D"></p>
<p>Kubernetes Cluster and <code>Prime-flask</code> service are up:</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/qHWRZGl5mNmm3qDrdFFBubW%2BVadz0AvinAF%2BWtMTrBE%3D"></p>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> below to check your lab progress. If you successfully created infrastructure deployment, you'll see an assessment score.</p>
<ql-activity-tracking step="1">
    Create Deployment
</ql-activity-tracking>
<h2 id="step7">Exploring Prime-Flask Environments</h2>
<p>Three different environments have been set up that your Prime-flask app could traverse as it is making its way to becoming a container app living on a single virtual machine to a <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/" target="blank">pod</a> running on a container orchestration platform like Kubernetes.</p>
<p>Once your resources are ready, it would benefit you to explore the systems.</p>
<p>Run the following to go into the <code>vm-webserver</code> machine that has the application running on host OS:</p>
<pre><code>gcloud compute ssh vm-webserver --zone us-central1-a&#x000A;</code></pre>
<p>Type "Y" when asked if you want to continue.
Press <strong>Enter</strong> twice to not use a passphrase.</p>
<p>In this environment there is no isolation, and portability is less efficient. In a sense, the app has access to the whole system, and, depending on other factors, may not have automatic recovery of application if it fails. Scaling up this application may require more virtual machines to spin up and most likely will not be the best use of resources.</p>
<p>List all processes:</p>
<pre><code class="language-bash prettyprint">ps aux&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-bash prettyprint">root       882  0.0  1.1  92824  6716 ?        Ss   18:41   0:00 sshd: user [priv]&#x000A;user       888  0.0  0.6  92824  4052 ?        S    18:41   0:00 sshd: user@pts/0&#x000A;user       889  0.0  0.6  19916  3880 pts/0    Ss   18:41   0:00 -bash&#x000A;user       895  0.0  0.5  38304  3176 pts/0    R+   18:41   0:00 ps aux&#x000A;apprunn+  7938  0.0  3.3  48840 20328 ?        Ss   Mar19   1:06 /usr/bin/python /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;apprunn+ 21662  0.0  3.9  69868 24032 ?        S    Mar20   0:05 /usr/bin/python /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;</code></pre>
<p>Then exit:</p>
<pre><code>exit&#x000A;</code></pre>
<p>Run the following to go into the <code>cos-vm</code> machine, where you have docker running the container.</p>
<pre><code class="language-bash prettyprint">gcloud compute ssh cos-vm --zone us-central1-a&#x000A;</code></pre>
<p>Type "Y" when asked if you want to continue.
Press <strong>Enter</strong> twice to not use a passphrase.</p>
<p>COS is an optimized operating system with small OS footprint, which is part of what makes it secure to run container workloads. It has cloud-init and has Docker runtime preinstalled. This system on its own could be great to run several containers that did not need to be run on a platform that provided higher levels of reliability.</p>
<p>Clone the build files:</p>
<pre><code>git clone https://github.com/GoogleCloudPlatform/gke-migration-to-containers.git&#x000A;cd gke-migration-to-containers/container&#x000A;</code></pre>
<p>Build the docker image locally with the following command:</p>
<pre><code>sudo docker build -t gcr.io/migration-to-containers/prime-flask:1.0.2 .&#x000A;</code></pre>
<p>Run the following command to get a list of processes running on port 8080:</p>
<pre><code>ps aux | grep 8080&#x000A;</code></pre>
<p>You should receive a similar output:</p>
<p><img alt="processes" src="https://cdn.qwiklabs.com/KF2xdNT2JR6ncwPRe%2BUnwv73LHcNzFMsJEJZvivCdRU%3D"></p>
<p>Find the first <code>chronos</code> port number, which will look like the following:</p>
<p><img alt="cron-port" src="https://cdn.qwiklabs.com/RRvlu3k%2FJ%2BWQ8lFEhLzXhZP3VhoSpZZmuNxtvBQ5EmU%3D"></p>
<p>Then run the following command to kill the process on the port number, replacing <code>&lt;YOUR_PORT_NUMBER&gt;</code> with the cron port number you found (in the above example, you would use 763):</p>
<pre><code>sudo kill -9 &lt;YOUR_PORT_NUMBER&gt;&#x000A;</code></pre>
<p>Now run the following docker command to retrieve the local image and run it on the vm:</p>
<pre><code>sudo docker run --rm -d --name=appuser -p 8080:8080 gcr.io/migration-to-containers/prime-flask:1.0.2&#x000A;</code></pre>
<p>You can also run <code>ps aux</code> on the host and see the <code>prime-flask</code> running:</p>
<pre><code>ps aux&#x000A;</code></pre>
<p>Notice the docker and container references:</p>
<pre><code class="language-bash prettyprint">root         626  0.0  5.7 496812 34824 ?        Ssl  Mar19   0:14 /usr/bin/docker run --rm --name=flaskservice -p 8080:8080 gcr.io/migration-to-containers/prime-flask:1.0.2&#x000A;root         719  0.0  0.5 305016  3276 ?        Sl   Mar19   0:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 8080 -container-ip 172.17.0.2 -container-port 8080&#x000A;root         724  0.0  0.8 614804  5104 ?        Sl   Mar19   0:09 docker-containerd-shim -namespace moby -workdir /var/lib/docker/containerd/daemon/io.containerd.runtime.v1.linux/mo&#x000A;chronos      741  0.0  0.0    204     4 ?        Ss   Mar19   0:00 /usr/bin/dumb-init /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;chronos      774  0.0  3.2  21324 19480 ?        Ss   Mar19   1:25 /usr/local/bin/python /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;chronos    14376  0.0  4.0  29700 24452 ?        S    Mar20   0:05 /usr/local/bin/python /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;</code></pre>
<p>Also notice, if you try to list the python path it does not exist:</p>
<pre><code>ls /usr/local/bin/python&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-bash prettyprint">ls: cannot access '/usr/local/bin/python': No such file or directory&#x000A;</code></pre>
<p>Docker list containers:</p>
<pre><code class="language-bash prettyprint">sudo docker ps&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-bash prettyprint">CONTAINER ID        IMAGE                                                  COMMAND                  CREATED             STATUS              PORTS                    NAMES&#x000A;d147963ec3ca        gcr.io/migration-to-containers/prime-flask:1.0.2   "/usr/bin/dumb-init …"   39 hours ago        Up 39 hours         0.0.0.0:8080-&gt;8080/tcp   flaskservice&#x000A;</code></pre>
<p>Now you can execute a command to see running process on the container:</p>
<pre><code class="language-bash prettyprint">sudo docker exec -it $(sudo docker ps |awk '/prime-flask/ {print $1}') ps aux&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-bash prettyprint">PID   USER     TIME  COMMAND&#x000A;    1 apprunne  0:00 /usr/bin/dumb-init /usr/local/bin/gunicorn --bind 0.0.0.0:&#x000A;    6 apprunne  1:25 {gunicorn} /usr/local/bin/python /usr/local/bin/gunicorn -&#x000A;   17 apprunne  0:05 {gunicorn} /usr/local/bin/python /usr/local/bin/gunicorn -&#x000A;   29 apprunne  0:00 ps aux&#x000A;</code></pre>
<p>Type in "exit":</p>
<pre><code>exit&#x000A;</code></pre>
<p>Next, go into the Kubernetes environment. Here you can run hundreds or thousands of <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/" target="blank">pods</a> that are groupings of containers. Kubernetes is the defacto standard for deploying containers these days. It offers high productivity, reliability, and scalability. Kubernetes makes sure your containers have a home, and if a container happens to fail, it will respawn it again. You can have many machines making up the cluster and in so doing you can spread it across different zones ensuring availability, and resilience to potential issues.</p>
<p>Get cluster configuration:</p>
<pre><code class="language-bash prettyprint">gcloud container clusters get-credentials prime-server-cluster&#x000A;</code></pre>
<p>Get pods running in the default namespace:</p>
<pre><code class="language-bash prettyprint">kubectl get pods&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-bash prettyprint">NAME                            READY   STATUS    RESTARTS   AGE&#x000A;prime-server-6b94cdfc8b-dfckf   1/1     Running   0          2d5h&#x000A;</code></pre>
<p>See what is running on the pod:</p>
<pre><code class="language-bash prettyprint">kubectl exec $(kubectl get pods -lapp=prime-server -ojsonpath='{.items[].metadata.name}')  -- ps aux&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-bash prettyprint">PID   USER     TIME  COMMAND&#x000A;    1 apprunne  0:00 /usr/bin/dumb-init /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;    6 apprunne  1:16 {gunicorn} /usr/local/bin/python /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;    8 apprunne  2:52 {gunicorn} /usr/local/bin/python /usr/local/bin/gunicorn --bind 0.0.0.0:8080 prime-flask-server&#x000A;   19 apprunne  0:00 ps aux&#x000A;</code></pre>
<p>As you can see, the python application is now running in a container. The application can't access anything on the host. The container is isolated. It runs in a linux namespace and can't (by default) access files, the network, or other resources running on the VM, in containers or otherwise.</p>
<h2 id="step8">Validation</h2>
<p>Now that the application is deployed, validate these three deployments by executing:</p>
<pre><code class="language-console prettyprint">make validate&#x000A;</code></pre>
<p>Occasionally the APIs take a few moments to complete. Running <code>make validate</code> immediately could potentially appear to fail, but in fact the instances haven't finished initializing. Waiting for a minute or two and retrying the command should resolve any issues.</p>
<p>A successful output will look like this:</p>
<pre><code class="language-console prettyprint">Validating Debian VM Webapp...&#x000A;Testing endpoint http://35.227.149.80:8080&#x000A;Endpoint http://35.227.149.80:8080 is responding.&#x000A;**** http://35.227.149.80:8080/prime/10&#x000A;The sum of all primes less than 10 is 17&#x000A;The factorial of 10 is 3628800&#x000A;&#x000A;Validating Container OS Webapp...&#x000A;Testing endpoint http://35.230.123.231:8080&#x000A;Endpoint http://35.230.123.231:8080 is responding.&#x000A;**** http://35.230.123.231:8080/prime/10&#x000A;The sum of all primes less than 10 is 17&#x000A;The factorial of 10 is 3628800&#x000A;&#x000A;Validating Kubernetes Webapp...&#x000A;Testing endpoint http://35.190.89.136&#x000A;Endpoint http://35.190.89.136 is responding.&#x000A;**** http://35.190.89.136/prime/10&#x000A;The sum of all primes less than 10 is 17&#x000A;The factorial of 10 is 3628800&#x000A;</code></pre>
<p>Of course, the IP addresses will likely differ for your deployment.</p>
<h2 id="step9">Load Testing</h2>
<p>In Cloud Shell click the <strong>+</strong> to open a new Cloud Shell tab.</p>
<p>Execute the following, for each resource, replacing <code>[IP_ADDRESS]</code> with the <strong>IP address and port</strong> from your validation output in the previous step. Note that the Kubernetes deployment runs on port <code>80</code>, while the other two deployments run on port <code>8080</code>:</p>
<pre><code class="language-console prettyprint">ab -c 120 -t 60  http://&lt;IP_ADDRESS&gt;/prime/10000&#x000A;</code></pre>
<p>ApacheBench (<code>ab</code>) will execute 120 concurrent requests against the provided endpoint for 1 minute. The demo application's replica is insufficiently sized to handle this volume of requests.</p>
<p>This can be confirmed by reviewing the output from the <code>ab</code> command. If you see a <code>Failed requests</code> value of greater than 0, this means that the server couldn't respond successfully to this load:</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/zRrDWLQ7U4IfJlnoD2ZtVfvwo%2Bx8S0GI1H4zZDUBOBM%3D"></p>
<p><strong>Note:</strong> You may not see failures on all three of your resources.</p>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> below to check your lab progress. If you successfully performed load testing, you'll see an assessment score.</p>
<ql-activity-tracking step="2">
    Load Testing
</ql-activity-tracking>
<p>One way to ensure that your system has the capacity to handle this type of traffic is by scaling up. In this case, scale the service horizontally.</p>
<p>In the Debian and COS architectures, horizontal scaling would include:</p>
<ol>
<li>Creating a load balancer.</li>
<li>Spinning up additional instances.</li>
<li>Registering them with the load balancer.</li>
</ol>
<p>This is an involved process and is out of scope for this demonstration.</p>
<p>For the third (Kubernetes) deployment, the process is far easier.</p>
<p>In your 1st Cloud Shell tab, run the following:</p>
<pre><code class="language-console prettyprint">kubectl scale --replicas 3 deployment/prime-server&#x000A;</code></pre>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> below to check your lab progress. If you successfully scaled deployment, you'll see an assessment score.</p>
<ql-activity-tracking step="3">
    Scale prime-server deployment
</ql-activity-tracking>
<p>After allowing 30 seconds for the replicas to initialize, re-run the load test:</p>
<pre><code class="language-console prettyprint">ab -c 120 -t 60  http://&lt;IP_ADDRESS&gt;/prime/10000&#x000A;</code></pre>
<p>Notice how the <code>Failed requests</code> is now 0. This means that all of the 10,000+ requests were successfully answered by the server:</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/xN8Ara7Oz6%2BUbDrxvfhCwfawr%2FgXoMD4zcbzwUFpMWE%3D"></p>
<h2 id="step10">Tear Down</h2>
<p>Although Qwiklabs will clean up all resources provided to you for this lab, it's good to know how to clean up your own environment.</p>
<p>Run the following in your 1st Cloud Shell tab:</p>
<pre><code>make teardown&#x000A;</code></pre>
<p>It will run <code>terraform destroy</code> which will destroy all of the resources created for this demonstration.</p>
<p><img alt="screenshot" src="https://cdn.qwiklabs.com/FWthwHGVx6G6KkmTg3wVA6lJuXmG%2BZqA24RDwyfiMVo%3D"></p>
<h2 id="step11">Congratulations!</h2>
<h3>Finish Your Quest</h3>
<p><img alt="Enterprise-Customers.png" src="https://cdn.qwiklabs.com/XArdOxOtBmZg8V4GpuBLqcLsnklweSkkEkmbmTtqBHE%3D"></p>
<p>This self-paced lab is part of the Qwiklabs <a href="https://google.qwiklabs.com/quests/64" target="_blank">Google Kubernetes Engine Best Practices: Security</a> Quest. A Quest is a series of related labs that form a learning path. Completing this Quest earns you the badge above, to recognize your achievement. You can make your badge (or badges) public and link to them in your online resume or social media account. <a href="https://google.qwiklabs.com/quests/64/enroll" target="_blank">Enroll in this Quest</a> and get immediate completion credit if you've taken this lab.  <a href="https://google.qwiklabs.com/catalog" target="_blank">See other available Qwiklabs Quests</a>.</p>
<h3>Take your next lab</h3>
<p>Continue your Quest with  <a href="https://google.qwiklabs.com/catalog_lab/1764" target="_blank">How to Use a Network Policy on Kubernetes Engine</a>, or check out these suggestions:</p>
<ul>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/1718" target="_blank">Google Kubernetes Engine Security: Binary Authorization</a></p>
</li>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/1720" target="_blank">Accessing Role-based Access Control in Kubernetes Engine</a></p>
</li>
</ul>
<h3>Next Steps / Learn More</h3>
<ul>
<li>For additional information see: <a href="https://www.youtube.com/watch?v=_aFA-p87Eec&amp;index=22&amp;list=PLBgogxgQVM9uSqzLOc66kNIZMUOvnGbU4" target="_blank">Embarking on a Journey Towards Containerizing Your Workloads</a>.</li>
<li>More information on <a href="https://cloud.google.com/compute/docs/instances/" target="_blank">virtual machines</a>.</li>
</ul>
<h3>Google Cloud Training &amp; Certification</h3>
<p>...helps you make the most of Google Cloud technologies. <a href="https://cloud.google.com/training/courses" target="_blank">Our classes</a> include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. <a href="https://cloud.google.com/certification/" target="_blank">Certifications</a> help you validate and prove your skill and expertise in Google Cloud technologies.</p>

<h5>Manual Last Updated December 10, 2020</h5>
<h5>Lab Last Tested December 10, 2020</h5>
<p>Copyright 2020 Google LLC. This software is provided as-is, without warranty or representation for any use or purpose. Your use of it is subject to your agreement with Google</p>



</div>
</div>


<div class='hidden js-end-lab-button-container lab-content__end-lab-button'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
<div class='lab-content__renderable-instructions'>
<div class='lab-content__recommendation'>
<!-- # TODO: Change classes so that this doesn't stack vertically -->
<section class='upcoming-cards'>
<h2 class='ql-headline-4'>Continue questing</h2>
<div class='content-card-grid'>
<div class='card-content-wrapper js-content-card' data-id='2762' data-level='Advanced' data-name='Migrating to GKE Containers' data-type='Lab'>
<a class="card card--content elevation-0 content-lab" href="/focuses/12768?parent=catalog"><div class='card__image'>
<div class='card__image__inner' style='background-image: url(https://cdn.qwiklabs.com/assets/fractal4-1d205807c54d90fe4382315dbfc0dd665ddb825bbc90f3ca5db7d7170fa0df1b.jpg)'></div>
</div>
<div class='card__body'>
<div class='overline card--content__type'>
Lab
</div>
<h3 class='card--content__title'>
Migrating to GKE Containers
</h3>
<div class='card--content__description body-1'>
<p>
This lab teaches you how to migrate a stateless application from running on a VM to running on Kubernetes Engine (GKE). You will learn about the lifecycle of an application transitioning from a typical VM/OS-based deployment to three different containerized cloud infrastructure platforms.
</p>
</div>
</div>
<div class='card__footer'>
<div class='card__footer__left'>
<span>Advanced</span>
</div>
<div class='card__footer__right'>
<div class='rateit' data-rateit-readonly='true' data-rateit-value='4.2943'></div>
</div>
</div>
</a></div>

</div>
</section>

</div>

</div>
</ql-drawer-content>
<ql-drawer end id='outline-drawer' open slot='drawer' width='320'>
<div class='js-lab-content-outline lab-content__outline'>
<a href='#step1'>GSP475</a><a href='#step2'>Overview</a><a href='#step3'>What you'll learn</a><a href='#step4'>Architecture</a><a href='#step5'>Setup</a><a href='#step6'>Deployment</a><a href='#step7'>Exploring Prime-Flask Environments</a><a href='#step8'>Validation</a><a href='#step9'>Load Testing</a><a href='#step10'>Tear Down</a><a href='#step11'>Congratulations!</a>
</div>
</ql-drawer>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<div class='lab-introduction js-lab-introduction is-hidden'>
<div class='lab-introduction__inner'>
<h1 class='headline-1'>Welcome to Your First Lab!</h1>
<ql-icon-button class='js-skip-button'>close</ql-icon-button>
<div class='lab-introduction__video'>
<iframe allow='autoplay; encrypted-media' allowfullscreen frameborder='0' id='lab-introduction' src='https://www.youtube.com/embed/yF7EDXKTmoQ?enablejsapi=1&amp;rel=0&amp;showinfo=0'></iframe>
</div>
<a class='js-skip-button button button--outline'>Skip this video</a>
</div>
</div>



</div>
</main>


<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<div class='modal-body'>
<p class='l-mbm'>
This lab teaches you how to migrate a stateless application from running on a VM to running on Kubernetes Engine (GKE). You will learn about the lifecycle of an application transitioning from a typical VM/OS-based deployment to three different containerized cloud infrastructure platforms.
</p>
<p>
This lab is included in these quests:
<a href="/quests/64">Google Kubernetes Engine Best Practices: Security</a>, <a href="/quests/142">Secure Workloads in Google Kubernetes Engine</a>.
If you complete this lab you&#39;ll receive credit for it when you enroll in one of these quests.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
75m access
&middot;
75m completion
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>advanced</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://run.qwiklabs.com/catalog_lab/2762">https://run.qwiklabs.com/catalog_lab/2762</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-review-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<form class="simple_form js-lab-review-form" id="new_lab_review" action="/lab_reviews" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='modal-body'>
<p class='label'>
How satisfied are you with this lab?*
</p>
<div class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='0'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="4453388" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="2762" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Comment</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Cancel
</a>
<input type="submit" name="commit" value="Submit" disabled="disabled" id="submit" data-disabled="false" class="button" data-disable-with="Submit" />
</div>
</form>

</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-access-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<a class='lab-access-modal-close' data-analytics-action='dismissed_lab_payment_modal' data-dismiss='modal'>
<i class='material-icons'>close</i>
</a>
<form class="js-lab-access-form" action="/lab_onetime_coupons/activate?parent=catalog" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />
<div class='modal-body'>
<div class='lab-access-modal'>
<input type="hidden" name="id" id="id" value="12768" />
<input type="hidden" name="user_id" id="user_id" value="4453388" />
<input type="hidden" name="launch_with_credits" id="launch_with_credits" value="0" class="js-launch-with-credits-input" />
<input type="hidden" name="launch_with_subs" id="launch_with_subs" value="0" class="js-launch-with-subscription-input" />
<input type="hidden" name="launch_with_access_code" id="launch_with_access_code" value="0" class="js-launch-with-access-code" />
<div class='lab-access-modal__method'>
<p>
This lab costs
7 Credits.
</p>
<p>
You have a valid subscription package. Would you like to charge this lab to your subscription?

</p>
<a class='button js-launch-with-subscription-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_subscription_button'>
Use Subscription
</a>
</div>
<div class='lab-access-modal__method'>
<p>
Enter Lab Access Code:
</p>
<div class='lab-access-modal__code js-access-code'>
<input type="text" name="uuid_1" id="uuid_1" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_2" id="uuid_2" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_3" id="uuid_3" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_4" id="uuid_4" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
</div>
<a class='button js-launch-with-access-code-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_access_code_button'>
Launch with Access Code
</a>
</div>
</div>
</div>
</form>



</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>


<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.favoriting.init();
  ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  initLabAccessModal();
  ql.labAssessment.init();
  ql.labIntroduction.init( true );
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?\n","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.\n","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.chat.init();
  ql.initHeader();
  ql.navigation.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

